# Step 1: Initial structure generation and alignment

This step generates a single linear ELP–linker–Car9 chain using AmberTools and aligns the chain
along the z-axis. This alignment is required to reproducibly pack multiple copies of the chain
in a grid using PACKMOL in subsequent steps.

This directory contains a representative example for the ELP-linker-Car9 system, which serves as a
template for all sequence variants used in this study.

---

## Overview of the workflow

1. Generate a single capped ELP–linker–Car9 chain using `tleap`
2. Compute a molecular long-axis vector from the alpha carbons of the first and last residues
3. Apply a rigid-body translation and rotation in VMD to align the chain along the z-axis
4. Write out a z-axis–aligned PDB for downstream packing

---

## 1. Initial structure generation (AmberTools / tleap)

The initial structure is generated using **AmberTools 22** (`tleap`) with standard AMBER protein
residues.

- Termini: **ACE (N-terminus), NME (C-terminus)**
- Protonation state: **default AMBER protonation at pH ≈ 7**
- No nonstandard residues are used

### Files
- `tleap/leap.in` — tleap input file defining the sequence and caps
- `tleap/leap.log` — tleap log file 

### Command
Note: load/source amber22 before running this command
```bash
tleap -f leap.in
```

## 2. Long-axis vector calculation

To enable reproducible packing of multiple chains in a grid, a single ELP–linker–Car9 chain is first
oriented consistently in space. As a simple and robust definition of the molecular long axis, we use
the vector connecting the alpha carbons (CA) of the first and last amino acid residues
(excluding ACE and NME terminal caps).

### Method

The long-axis vector **v** is computed as:

```math
 \mathbf{v} = \mathbf{r}_{\mathrm{CA,first}} - \mathbf{r}_{\mathrm{CA,last}}
```

where $ \mathbf{r}_{\mathrm{CA,first}}$ and $\mathbf{r}_{\mathrm{CA,last}}$ are the Cartesian coordinates of the
CA atoms of the first and last residues, respectively.

This definition is sufficient for a linear ELP-based construct and avoids ambiguity associated with
internal flexibility or terminal caps.

### Files

- `python/long_axis_vector.py`  
  Python script that computes the long-axis vector from the input PDB.

- `output/elp_car9_LA.txt`  
  Text file recording the computed vector for traceability.

### Command

```bash
python python/long_axis_vector.py output/elp_car9.pdb
```

## 3. Alignment along the z-axis (VMD)

The single-chain structure generated by `tleap` is arbitrarily oriented in space. To reproducibly
assemble multiple copies of the chain into a grid representing a polymer brush–like system, the
chain is aligned such that its molecular long axis coincides with the **z-axis**.

### Alginment procedure
Alignment is performed in VMD using a TCL script that applies:

1. A rigid-body translation using th einverse of the comptued long-axis vector
2. A rigid-body rotation to align the chain with the z axis
3. Writing of the transformed coordinates to a new PDB file

No internal degrees of freedom are altered during this step. 

### Files

- `vmd/align.tcl`  
  VMD TCL script applying translation and rotation and writing the aligned structure.

### Running the Alignment

For batch runs:
```bash
vmd ../output/elp_car9.pdb -e vmd/align.tcl -dispdev text
```
With GUI and visual verification, remove `quit` from align.tcl and run:
```bash
vmd ../output/elp_car9.pdb -e vmd/align.tcl
```

### Output

- `output/elp_car9.pdb` - single-chain structure generated using `tleap`
- `output/elp_car9_LA.txt` - long axis vector for the single-chain structure
- `output/elp_car9_aligned.pdb` - single-chain structure aligned along the z-axis

This aligned structure is used as the input for PACKMOL-based system assembly in Step 2. 

### NOTES

- This procedure is shown for the ELP-linker-Car9 system as a representative example.
- The same workflow was applied to all sequence variants. 
- Automation scripts used to replicate this step across variants are provided at the top level of the repository for reference. 